<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Food Online</title>
</head>
<body>
  <h1>Pick Your Food</h1>
  <img th:src="@{/images/taco-cloud.png}" width="250" height="200"/>

  <form id="orderForm" action="design" method="post" th:object="${design}">
    <div class="grid">
      <div class="ingredient-group" id="asian">
        <h3>Asian Cuisine</h3>
        <div th:each="menu : ${asians}">
          <div class="custom-control custom-checkbox">
            <input name="menu" type="checkbox" class="custom-control-input" id="menuAsian" th:value="${menu.id}">
            <label class="custom-control-label" for="menuAsian" th:text="${menu.name}"></label>
          </div>
        </div>
      </div>

      <div class="ingredient-group" id="fastFoods">
        <h3>Fast Foods</h3>
        <div th:each="menu : ${fastFoods}">
          <div class="custom-control custom-checkbox">
            <input name="menu" type="checkbox" class="custom-control-input" id="menuFastFood" th:value="${menu.id}">
            <label class="custom-control-label" for="menuFastFood" th:text="${menu.name}"></label>
          </div>
        </div>
      </div>

      <div class="ingredient-group" id="french">
        <h3>French Cuisine</h3>
        <div th:each="menu : ${french}">
          <div class="custom-control custom-checkbox">
            <input name="menu" type="checkbox" class="custom-control-input" id="menuFrench" th:value="${menu.id}">
            <label class="custom-control-label" for="menuFrench" th:text="${menu.name}"></label>
          </div>
        </div>
      </div>

      <div class="ingredient-group" id="italian">
        <h3>Italian Cuisine</h3>
        <div th:each="menu : ${italian}">
          <div class="custom-control custom-checkbox">
            <input name="menu" type="checkbox" class="custom-control-input" id="menuItalian" th:value="${menu.id}">
            <label class="custom-control-label" for="menuItalian" th:text="${menu.name}"></label>
          </div>
        </div>
      </div>

      <div class="ingredient-group" id="japanese">
        <h3>Japanese Cuisine</h3>
        <div th:each="menu : ${japanese}">
          <div class="custom-control custom-checkbox">
            <input name="menu" type="checkbox" class="custom-control-input" id="menuJapanese" th:value="${menu.id}">
            <label class="custom-control-label" for="menuJapanese" th:text="${menu.name}"></label>
          </div>
        </div>
      </div>
    </div>

    <div>
      <h3>Total Price: <span id="totalPrice">$0</span></h3>
      <button type="submit" class="btn btn-primary">Confirm Your Order</button>
    </div>

    <!-- Add hidden input fields to store checkbox values -->
    <input type="hidden" name="checkedItems" id="checkedItemsInput" />
    <input type="hidden" name="totalPrice" id="totalPriceInput" />
    <input type="hidden" name="token" th:value="${token}" />

  </form>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const checkboxes = document.querySelectorAll('input[type="checkbox"]');
      const totalPriceSpan = document.getElementById('totalPrice');

      const checkedItemsInput = document.getElementById('checkedItemsInput');
      const totalPriceInput = document.getElementById('totalPriceInput');
      const orderForm = document.getElementById('orderForm');

      checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', updateTotalPrice);
      });

      function updateTotalPrice() {
        let totalPrice = 0;
        const checkedItems = [];

        checkboxes.forEach(function (cb) {
          if (cb.checked) {
            totalPrice += 10; // Assuming each checkbox adds $10 to the total price
            checkedItems.push(cb.value);
          }
        });
        totalPriceSpan.textContent = '$' + totalPrice;
        checkedItemsInput.value = checkedItems.join(',');
        totalPriceInput.value = totalPrice;
      }

      orderForm.addEventListener('submit', function (event) {
        event.preventDefault();
        // Call the function to update the total price before submitting the form
        updateTotalPrice();

        // Submit the form using fetch API
        fetch('/design', {
          method: 'POST',
          body: new FormData(orderForm),
        })
                .then(response => {
                  // Handle response if needed
                  console.log('Form submitted successfully');
                  window.location.href = "/orders/current";
                })
                .catch(error => {
                  console.error('Error submitting form:', error);
                });
      });
    });
  </script>
</body>
</html>